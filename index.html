<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Practice Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#FEFCF8;--card:#FFFFFF;--primary:#FF6B35;--primary-light:#FFF0E8;--secondary:#2EC4B6;--secondary-light:#E6FAF8;--accent:#FFD166;--accent-light:#FFF8E1;--correct:#06D6A0;--correct-bg:#E6FBF4;--wrong:#EF476F;--wrong-bg:#FDE8EE;--text:#2B2D42;--text-light:#6B7194;--border:#E8E0D8;--shadow:0 4px 24px rgba(43,45,66,.07);--shadow-hover:0 8px 32px rgba(43,45,66,.13);--radius:18px}
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;top:-150px;right:-100px;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(255,209,102,.12) 0%,transparent 70%);pointer-events:none;z-index:0}
  body::after{content:'';position:fixed;bottom:-120px;left:-80px;width:420px;height:420px;border-radius:50%;background:radial-gradient(circle,rgba(46,196,182,.1) 0%,transparent 70%);pointer-events:none;z-index:0}

  /* Auth */
  .auth-screen{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative;z-index:1}
  .auth-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:40px 36px;box-shadow:var(--shadow);max-width:420px;width:100%;animation:fadeIn .4s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  .auth-icon{text-align:center;font-size:3rem;margin-bottom:8px}
  .auth-title{font-family:'Fredoka',sans-serif;font-weight:700;font-size:1.6rem;text-align:center;margin-bottom:4px}
  .auth-subtitle{text-align:center;font-size:.92rem;font-weight:600;color:var(--text-light);margin-bottom:28px}
  .form-group{margin-bottom:18px}
  .form-group label{display:block;font-weight:700;font-size:.85rem;margin-bottom:6px;color:var(--text)}
  .form-input{width:100%;padding:12px 16px;border:2px solid var(--border);border-radius:12px;font-family:'Nunito',sans-serif;font-size:.95rem;font-weight:600;color:var(--text);background:var(--bg);transition:border-color .2s}
  .form-input:focus{outline:none;border-color:var(--primary)}
  .form-input::placeholder{color:var(--text-light);opacity:.6}
  .auth-btn{width:100%;padding:14px;border:none;border-radius:12px;font-family:'Fredoka',sans-serif;font-weight:700;font-size:1.05rem;cursor:pointer;transition:all .2s;margin-top:6px}
  .auth-btn:hover{transform:translateY(-2px)}.auth-btn:active{transform:translateY(0)}.auth-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
  .auth-btn-primary{background:var(--primary);color:#fff;box-shadow:0 4px 14px rgba(255,107,53,.3)}
  .auth-btn-primary:hover:not(:disabled){background:#e55a28}
  .auth-btn-secondary{background:var(--secondary);color:#fff;box-shadow:0 4px 14px rgba(46,196,182,.3);margin-top:10px}
  .auth-btn-secondary:hover:not(:disabled){background:#26b0a3}
  .auth-btn-outline{background:transparent;color:var(--primary);border:2px solid var(--border);margin-top:10px}
  .auth-btn-outline:hover{border-color:var(--primary);background:var(--primary-light)}
  .auth-switch{text-align:center;margin-top:20px;font-size:.9rem;font-weight:600;color:var(--text-light)}
  .auth-switch a{color:var(--primary);text-decoration:none;font-weight:700;cursor:pointer}
  .auth-switch a:hover{text-decoration:underline}
  .auth-error{background:var(--wrong-bg);color:#be123c;border:2px solid var(--wrong);border-radius:12px;padding:12px 16px;font-weight:700;font-size:.88rem;margin-bottom:16px;display:none;animation:fadeIn .3s}
  .auth-success{background:var(--correct-bg);color:#047857;border:2px solid var(--correct);border-radius:12px;padding:12px 16px;font-weight:700;font-size:.88rem;margin-bottom:16px;display:none;animation:fadeIn .3s}
  .verify-icon{text-align:center;font-size:3.5rem;margin-bottom:12px}
  .verify-text{text-align:center;font-size:.95rem;font-weight:600;color:var(--text-light);line-height:1.6;margin-bottom:20px}
  .verify-email{font-weight:700;color:var(--primary)}
  .loading-screen{min-height:100vh;display:flex;align-items:center;justify-content:center}
  .spinner{width:48px;height:48px;border:4px solid var(--border);border-top:4px solid var(--primary);border-radius:50%;animation:spin .8s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* App */
  .app-screen{display:none}
  .hero{background:linear-gradient(135deg,var(--primary) 0%,#FF8C5A 50%,var(--accent) 100%);padding:32px 32px 44px;text-align:center;position:relative;overflow:hidden}
  .hero::before{content:'';position:absolute;top:-50%;left:-10%;width:120%;height:200%;background:repeating-linear-gradient(45deg,transparent,transparent 24px,rgba(255,255,255,.04) 24px,rgba(255,255,255,.04) 48px);pointer-events:none}
  .hero::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:28px;background:var(--bg);border-radius:50% 50% 0 0/100% 100% 0 0}
  .hero-top{display:flex;justify-content:flex-end;align-items:center;gap:12px;margin-bottom:16px;position:relative;z-index:1}
  .user-badge{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.18);border-radius:10px;padding:6px 14px;font-size:.82rem;font-weight:700;color:#fff}
  .logout-btn{background:rgba(255,255,255,.2);border:none;color:#fff;padding:6px 14px;border-radius:10px;font-family:'Nunito',sans-serif;font-weight:700;font-size:.82rem;cursor:pointer;transition:background .2s}
  .logout-btn:hover{background:rgba(255,255,255,.35)}
  .hero-icon{font-size:2.8rem;margin-bottom:8px;position:relative;animation:float 3s ease-in-out infinite}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
  .hero h1{font-family:'Fredoka',sans-serif;font-weight:700;font-size:2.2rem;color:#fff;letter-spacing:.5px;position:relative;margin-bottom:8px}
  .hero p{color:rgba(255,255,255,.92);font-size:1.05rem;font-weight:600;position:relative;max-width:520px;margin:0 auto;line-height:1.6}
  .stats-ribbon{display:flex;justify-content:center;gap:24px;margin:-18px auto 0;position:relative;z-index:2;flex-wrap:wrap;padding:0 20px}
  .stat-chip{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 24px;box-shadow:var(--shadow);display:flex;align-items:center;gap:10px;min-width:150px;justify-content:center}
  .stat-chip-icon{font-size:1.4rem}
  .stat-chip-text{font-weight:700;font-size:.92rem;color:var(--text)}
  .stat-chip-text span{display:block;font-size:.75rem;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:.4px}
  .main{max-width:820px;margin:36px auto 48px;padding:0 20px;position:relative;z-index:1}
  .section-title{font-family:'Fredoka',sans-serif;font-weight:700;font-size:1.35rem;color:var(--text);margin-bottom:20px;display:flex;align-items:center;gap:10px}
  .practice-grid{display:flex;flex-direction:column;gap:16px}
  .practice-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:0;box-shadow:var(--shadow);transition:all .3s ease;overflow:hidden;text-decoration:none;color:inherit;display:block;position:relative}
  .practice-card:hover{box-shadow:var(--shadow-hover);transform:translateY(-3px);border-color:var(--primary)}
  .practice-card:hover .card-arrow{transform:translateX(4px);color:var(--primary)}
  .card-stripe{height:5px;width:100%}
  .stripe-1{background:linear-gradient(90deg,var(--primary),var(--accent))}.stripe-2{background:linear-gradient(90deg,var(--secondary),#7DD3C8)}.stripe-3{background:linear-gradient(90deg,#A78BFA,#818CF8)}
  .card-body{padding:22px 28px;display:flex;align-items:center;justify-content:space-between;gap:16px}
  .card-info{flex:1}
  .card-title{font-family:'Fredoka',sans-serif;font-weight:700;font-size:1.15rem;color:var(--text);margin-bottom:6px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .card-number-badge{font-size:.72rem;font-weight:700;padding:3px 10px;border-radius:8px;background:var(--primary-light);color:var(--primary)}
  .card-meta{display:flex;flex-wrap:wrap;gap:12px;font-size:.84rem;font-weight:600;color:var(--text-light)}
  .card-meta-item{display:flex;align-items:center;gap:5px}
  .card-topics{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
  .topic-tag{font-size:.7rem;font-weight:700;padding:3px 10px;border-radius:8px;text-transform:uppercase;letter-spacing:.3px}
  .tag-logic{background:#EDE7F6;color:#5E35B1}.tag-math{background:#E3F2FD;color:#1565C0}.tag-everyday{background:#FFF3E0;color:#E65100}.tag-achiever{background:#FCE4EC;color:#C62828}
  .card-arrow{font-size:1.5rem;color:var(--border);transition:all .3s ease;flex-shrink:0}
  .coming-soon-card{background:var(--card);border:2px dashed var(--border);border-radius:var(--radius);padding:32px;text-align:center;opacity:.7}
  .coming-soon-icon{font-size:2rem;margin-bottom:8px}
  .coming-soon-text{font-family:'Fredoka',sans-serif;font-weight:600;font-size:1rem;color:var(--text-light)}
  .coming-soon-sub{font-size:.88rem;font-weight:600;color:var(--text-light);opacity:.7;margin-top:4px}
  .footer{text-align:center;padding:24px 20px 36px;font-size:.82rem;font-weight:600;color:var(--text-light);opacity:.6}
  .practice-card,.coming-soon-card{animation:slideUp .4s ease both}
  .practice-card:nth-child(1){animation-delay:.1s}.practice-card:nth-child(2){animation-delay:.2s}.practice-card:nth-child(3){animation-delay:.3s}.coming-soon-card{animation-delay:.4s}
  @keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  .hidden{display:none!important}
  @media(max-width:600px){.hero{padding:24px 20px 36px}.hero h1{font-size:1.7rem}.stat-chip{padding:10px 16px;min-width:120px}.card-body{padding:18px 20px}.card-title{font-size:1.05rem}.stats-ribbon{gap:10px}.auth-card{padding:28px 24px}}
</style>
</head>
<body>

<!-- LOADING -->
<div class="loading-screen" id="loadingScreen"><div class="spinner"></div></div>

<!-- LOGIN -->
<div class="auth-screen hidden" id="loginScreen">
  <div class="auth-card">
    <div class="auth-icon">üß†</div>
    <div class="auth-title">Welcome Back!</div>
    <div class="auth-subtitle">Sign in to access your practice quizzes</div>
    <div class="auth-error" id="loginError"></div>
    <div class="form-group"><label>Email</label><input class="form-input" type="email" id="loginEmail" placeholder="your@email.com" autocomplete="email"></div>
    <div class="form-group"><label>Password</label><input class="form-input" type="password" id="loginPassword" placeholder="Enter your password" autocomplete="current-password"></div>
    <button class="auth-btn auth-btn-primary" id="loginBtn" onclick="handleLogin()">Sign In</button>
    <div class="auth-switch">Don't have an account? <a onclick="showScreen('signupScreen')">Create one</a></div>
  </div>
</div>

<!-- SIGNUP -->
<div class="auth-screen hidden" id="signupScreen">
  <div class="auth-card">
    <div class="auth-icon">‚ú®</div>
    <div class="auth-title">Create Account</div>
    <div class="auth-subtitle">Sign up to start practicing</div>
    <div class="auth-error" id="signupError"></div>
    <div class="form-group"><label>Display Name</label><input class="form-input" type="text" id="signupName" placeholder="Your name" autocomplete="name"></div>
    <div class="form-group"><label>Email</label><input class="form-input" type="email" id="signupEmail" placeholder="your@email.com" autocomplete="email"></div>
    <div class="form-group"><label>Password</label><input class="form-input" type="password" id="signupPassword" placeholder="At least 6 characters" autocomplete="new-password"></div>
    <button class="auth-btn auth-btn-secondary" id="signupBtn" onclick="handleSignup()">Create Account</button>
    <div class="auth-switch">Already have an account? <a onclick="showScreen('loginScreen')">Sign in</a></div>
  </div>
</div>

<!-- VERIFY EMAIL -->
<div class="auth-screen hidden" id="verifyScreen">
  <div class="auth-card">
    <div class="verify-icon">üìß</div>
    <div class="auth-title">Verify Your Email</div>
    <div class="verify-text">We sent a verification link to<br><span class="verify-email" id="verifyEmailDisplay"></span><br><br>Check your inbox (and spam folder), click the link, then come back and press the button below.</div>
    <div class="auth-error" id="verifyError"></div>
    <div class="auth-success" id="verifySuccess"></div>
    <button class="auth-btn auth-btn-primary" onclick="checkVerification()">I've Verified ‚Äî Let Me In</button>
    <button class="auth-btn auth-btn-outline" onclick="resendVerification()">Resend Verification Email</button>
    <button class="auth-btn auth-btn-outline" onclick="handleLogout()" style="margin-top:16px;font-size:.88rem;color:var(--text-light)">Sign out &amp; use a different account</button>
  </div>
</div>

<!-- MAIN APP -->
<div class="app-screen hidden" id="appScreen">
  <div class="hero">
    <div class="hero-top">
      <div class="user-badge"><span>üë§</span><span id="userDisplayName">User</span></div>
      <button class="logout-btn" onclick="handleLogout()">Sign Out</button>
    </div>
    <div class="hero-icon">üß†</div>
    <h1>Math Practice Hub</h1>
    <p>Grade 5 interactive practice quizzes inspired by the SOF International Mathematics Olympiad</p>
  </div>
  <div class="stats-ribbon">
    <div class="stat-chip"><div class="stat-chip-icon">üìù</div><div class="stat-chip-text">3<span>Quizzes Available</span></div></div>
    <div class="stat-chip"><div class="stat-chip-icon">‚ùì</div><div class="stat-chip-text">30<span>Total Questions</span></div></div>
    <div class="stat-chip"><div class="stat-chip-icon">üìö</div><div class="stat-chip-text">4<span>Topic Areas</span></div></div>
  </div>
  <div class="main">
    <div class="section-title">üìã Practice Quizzes</div>
    <div class="practice-grid">
      <a class="practice-card" href="math_quiz.html"><div class="card-stripe stripe-1"></div><div class="card-body"><div class="card-info"><div class="card-title">Practice #1<span class="card-number-badge">10 Questions</span></div><div class="card-meta"><div class="card-meta-item">üìÖ 14 Feb 2026</div><div class="card-meta-item">‚è±Ô∏è ~15 min</div><div class="card-meta-item">‚≠ê Mixed difficulty</div></div><div class="card-topics"><span class="topic-tag tag-logic">Logical Reasoning</span><span class="topic-tag tag-math">Mathematical Reasoning</span><span class="topic-tag tag-everyday">Everyday Math</span><span class="topic-tag tag-achiever">Achievers</span></div></div><div class="card-arrow">‚Üí</div></div></a>
      <a class="practice-card" href="math_quiz_2.html"><div class="card-stripe stripe-2"></div><div class="card-body"><div class="card-info"><div class="card-title">Practice #2<span class="card-number-badge">10 Questions</span></div><div class="card-meta"><div class="card-meta-item">üìÖ 15 Feb 2026</div><div class="card-meta-item">‚è±Ô∏è ~15 min</div><div class="card-meta-item">‚≠ê Mixed difficulty</div></div><div class="card-topics"><span class="topic-tag tag-logic">Logical Reasoning</span><span class="topic-tag tag-math">Mathematical Reasoning</span><span class="topic-tag tag-everyday">Everyday Math</span><span class="topic-tag tag-achiever">Achievers</span></div></div><div class="card-arrow">‚Üí</div></div></a>
      <a class="practice-card" href="math_quiz_3.html"><div class="card-stripe stripe-3"></div><div class="card-body"><div class="card-info"><div class="card-title">Practice #3<span class="card-number-badge">10 Questions</span></div><div class="card-meta"><div class="card-meta-item">üìÖ 16 Feb 2026</div><div class="card-meta-item">‚è±Ô∏è ~20 min</div><div class="card-meta-item">üî• High difficulty</div></div><div class="card-topics"><span class="topic-tag tag-logic">Logical Reasoning</span><span class="topic-tag tag-math">Mathematical Reasoning</span><span class="topic-tag tag-everyday">Everyday Math</span><span class="topic-tag tag-achiever">Achievers</span></div></div><div class="card-arrow">‚Üí</div></div></a>
      <div class="coming-soon-card"><div class="coming-soon-icon">üöÄ</div><div class="coming-soon-text">More practice quizzes coming soon!</div><div class="coming-soon-sub">Check back later for Practice #4, #5, and more.</div></div>
    </div>
  </div>
  <div class="footer">Math Practice Hub ‚Ä¢ Grade 5 ‚Ä¢ Based on SOF IMO 2019-20 Pattern</div>
</div>

<!-- FIREBASE SDK -->
<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged,sendEmailVerification,updateProfile}from"https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import{getFirestore,doc,setDoc,getDoc,updateDoc,serverTimestamp}from"https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyC1nF_1BiUq9PlNrtToxFgPQT9Z3KMv51M",
  authDomain:"aimathly.firebaseapp.com",
  projectId:"aimathly",
  storageBucket:"aimathly.firebasestorage.app",
  messagingSenderId:"822455826333",
  appId:"1:822455826333:web:e308eed90c331b73a5e174"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

// Expose to global for onclick handlers
window._auth=auth;window._db=db;
window._createUser=createUserWithEmailAndPassword;
window._signIn=signInWithEmailAndPassword;
window._signOut=signOut;
window._sendVerification=sendEmailVerification;
window._updateProfile=updateProfile;
window._doc=doc;window._setDoc=setDoc;window._getDoc=getDoc;window._updateDoc=updateDoc;window._serverTimestamp=serverTimestamp;

// Auth state listener ‚Äî core routing
onAuthStateChanged(auth,async(user)=>{
  hideAllScreens();
  if(!user){
    showScreen('loginScreen');
  }else if(!user.emailVerified){
    document.getElementById('verifyEmailDisplay').textContent=user.email;
    showScreen('verifyScreen');
  }else{
    document.getElementById('userDisplayName').textContent=user.displayName||user.email.split('@')[0];
    // Write user data to Firestore
    try{
      const userRef=doc(db,'users',user.uid);
      const snap=await getDoc(userRef);
      if(!snap.exists()){
        await setDoc(userRef,{displayName:user.displayName||user.email.split('@')[0],email:user.email,createdAt:serverTimestamp(),lastLogin:serverTimestamp()});
      }else{
        await updateDoc(userRef,{lastLogin:serverTimestamp()});
      }
    }catch(e){console.log('Firestore:',e.message)}
    showScreen('appScreen');
  }
});
</script>

<!-- AUTH LOGIC -->
<script>
function hideAllScreens(){['loadingScreen','loginScreen','signupScreen','verifyScreen','appScreen'].forEach(id=>{const e=document.getElementById(id);e.classList.add('hidden');if(id==='appScreen')e.style.display='none'})}
function showScreen(id){hideAllScreens();const e=document.getElementById(id);e.classList.remove('hidden');if(id==='appScreen')e.style.display='block'}
function showError(id,msg){const e=document.getElementById(id);e.textContent=msg;e.style.display='block'}
function clearErrors(){document.querySelectorAll('.auth-error,.auth-success').forEach(e=>e.style.display='none')}
function friendlyError(code){return{'auth/email-already-in-use':'This email is already registered. Try signing in.','auth/invalid-email':'Please enter a valid email address.','auth/weak-password':'Password must be at least 6 characters.','auth/user-not-found':'No account found with this email.','auth/wrong-password':'Incorrect password. Please try again.','auth/invalid-credential':'Incorrect email or password.','auth/too-many-requests':'Too many attempts. Please wait and try again.','auth/network-request-failed':'Network error. Check your connection.'}[code]||'Something went wrong. Please try again.'}

async function handleSignup(){
  clearErrors();
  const name=document.getElementById('signupName').value.trim();
  const email=document.getElementById('signupEmail').value.trim();
  const pw=document.getElementById('signupPassword').value;
  if(!name){showError('signupError','Please enter your name.');return}
  if(!email){showError('signupError','Please enter your email.');return}
  if(pw.length<6){showError('signupError','Password must be at least 6 characters.');return}
  const btn=document.getElementById('signupBtn');btn.disabled=true;btn.textContent='Creating Account...';
  try{const cred=await _createUser(_auth,email,pw);await _updateProfile(cred.user,{displayName:name});await _sendVerification(cred.user)}
  catch(e){showError('signupError',friendlyError(e.code));btn.disabled=false;btn.textContent='Create Account'}
}

async function handleLogin(){
  clearErrors();
  const email=document.getElementById('loginEmail').value.trim();
  const pw=document.getElementById('loginPassword').value;
  if(!email){showError('loginError','Please enter your email.');return}
  if(!pw){showError('loginError','Please enter your password.');return}
  const btn=document.getElementById('loginBtn');btn.disabled=true;btn.textContent='Signing In...';
  try{await _signIn(_auth,email,pw)}
  catch(e){showError('loginError',friendlyError(e.code));btn.disabled=false;btn.textContent='Sign In'}
}

async function checkVerification(){
  clearErrors();
  try{await _auth.currentUser.reload();
    if(_auth.currentUser.emailVerified){document.getElementById('userDisplayName').textContent=_auth.currentUser.displayName||_auth.currentUser.email.split('@')[0];showScreen('appScreen')}
    else{showError('verifyError','Email not yet verified. Check your inbox, click the link, then try again.')}
  }catch(e){showError('verifyError','Error checking verification. Please try again.')}
}

async function resendVerification(){
  clearErrors();
  try{await _sendVerification(_auth.currentUser);const e=document.getElementById('verifySuccess');e.textContent='Verification email sent! Check your inbox.';e.style.display='block'}
  catch(e){showError('verifyError',e.code==='auth/too-many-requests'?'Please wait before requesting another email.':'Could not send email. Try again later.')}
}

async function handleLogout(){try{await _signOut(_auth)}catch(e){console.error(e)}}

document.addEventListener('keydown',e=>{if(e.key!=='Enter')return;if(!document.getElementById('loginScreen').classList.contains('hidden'))handleLogin();else if(!document.getElementById('signupScreen').classList.contains('hidden'))handleSignup()});
</script>
</body>
</html>
